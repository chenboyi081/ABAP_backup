<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<html>
<head>
<title>ZSD020_DEFINE</title>
</head>
<body bgcolor="#FFFFE0">
<font size="3" face = "Arial" color="#000000"><b>Code listing for: ZSD020_DEFINE</b></font>
<br>
<font size="3" face = "Arial" color="#000000"><b>Description:  Include ZSD020_DEFINE</b></font>
<hr>
<pre width="100">
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*&  包括                ZSD020_DEFINE</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">***********************************************************************</font>
<font color ="#0000FF">* 类型池</font>
<font color ="#0000FF">************************************************************************</font>
TYPE-POOLS SLIS.
<font color ="#0000FF">************************************************************************</font>
<font color ="#0000FF">* 表声明</font>
<font color ="#0000FF">************************************************************************</font>
TABLES:VBRP,
       VBRK,
       VBPA,
       VBAK,
       LIKP.
<font color ="#0000FF">************************************************************************</font>
<font color ="#0000FF">* 类型定义</font>
<font color ="#0000FF">************************************************************************</font>
TYPES:BEGIN OF TY_WKP,
      SEL TYPE C,
      COLOR TYPE CHAR4,       " 颜色
      ZXH TYPE I,
      ZKPF TYPE VKDFS-KUNNR,                                              "开票方
      ZKPFNM TYPE KNA1-NAME1,
      VBELN TYPE VKDFS-VBELN,                                             "凭证号
      ZFKF TYPE VKDFS-KUNNR,                                              "付款方
      ZFKFNM TYPE KNA1-NAME1,
      VKORG TYPE VKDFS-VKORG,                                             "销售组织
      POSNR TYPE VBAP-POSNR,
      ZSDF TYPE VKDFS-KUNNR,                                              "售达方
      ZSDFNM TYPE KNA1-NAME1,
      FKART TYPE VKDFS-FKART,                                             "开票类别
      FKDAT TYPE VKDFS-FKDAT,                                             "出具发票日期
      FKTYP TYPE VKDFS-FKTYP,                                             "出具发票类别
      VTEXT TYPE TVFKT-VTEXT,                                             "开票类型名称
      SORTL TYPE KNA1-SORTL,                                              "检索项
      ZWKPJJ TYPE P DECIMALS 2,                                           "总开票净价
      ZWKPSJ TYPE P DECIMALS 2,                                           "总开票税价
      WAERK TYPE VBAK-WAERK,                                              "货币
      ZWKQTY TYPE VBRP-FKIMG,                                             "未开票数量
      VRKME TYPE LIPS-VRKME,                                              "销售单位
      MSEHL TYPE T006A-MSEHL,
      NETWR TYPE VBRP-NETWR,                                              "凭证净价
      MWSBP TYPE VBRP-MWSBP,                                              "凭证税金
      VTWEG TYPE VKDFS-VTWEG,                                             "分销渠道
      SPART TYPE VKDFS-SPART,                                             "产品组
      VBTYP TYPE VKDFS-VBTYP,                                             "凭证类别
      VSTEL TYPE VKDFS-VSTEL,                                             "装运点
      ARKTX TYPE VBAP-ARKTX,
      MATNR TYPE VBAP-MATNR,
      AUGRU TYPE VBAK-AUGRU,  " 订单原因
      ZCKDJ TYPE LIPS-VGBEL,  " 参考单据的单据编号
      ZCKXM TYPE LIPS-VGPOS,  " 参考项目的项目号
      VGTYP TYPE LIPS-VGTYP,  " SD 凭证类别
      ZGZRQ TYPE LIKP-WADAT_IST,  " 过账日期
      KNKLI TYPE LIKP-KNKLI,    " 信贷账户号
      ZHJJE TYPE P DECIMALS 2,                                            "合计金额
      END OF TY_WKP.

TYPES:BEGIN OF TY_YKP,
      COLOR TYPE CHAR4,       " 颜色
      ZXH TYPE I,
      ZKPF TYPE VBPA-KUNNR,                                               "开票方
      ZKPFNM TYPE KNA1-NAME1,
      VBELN TYPE VBRP-VBELN,                                              "凭证号
      VGPOS TYPE VBRP-VGPOS,
      KUNAG TYPE VBRK-KUNAG,                                              "售达方
      ZSDFNM TYPE KNA1-NAME1,
      POSNR TYPE VBRP-POSNR,
      ZFKF TYPE VBPA-KUNNR,                                               "付款方
      ZFKFNM TYPE KNA1-NAME1,                                             "付款方描述
      MATNR TYPE VBRP-MATNR,
      VKORG_AUFT TYPE VBRP-VKORG_AUFT,                                    "销售组织
      FKART TYPE VBRK-FKART,                                              "开票类别
      FKDAT TYPE VBRK-FKDAT,                                              "出具发票日期
      FKTYP TYPE VBRK-FKTYP,                                              "出具发票类别
      VTEXT TYPE TVFKT-VTEXT,                                             "开票类型名称
      PRODH TYPE VBRP-PRODH,                                              "产品层次
      NETWR TYPE VBRP-NETWR,
      MWSBP TYPE VBRP-MWSBP,
      ARKTX TYPE VBRP-ARKTX,
      FKIMG TYPE VBRP-FKIMG,
      VRKME TYPE VBRP-VRKME,
      MSEHL TYPE T006A-MSEHL,
      WERKS TYPE VBRP-WERKS,
      VGBEL TYPE VBRP-VGBEL,
      SORTL TYPE KNA1-SORTL,                                              "检索项
      ZYKPJJ TYPE P DECIMALS 2,                                           "总已开票净价
      ZYKPSJ TYPE P DECIMALS 2,                                           "总已开票税价
      WAERK TYPE VBAK-WAERK,                                              "货币
      ERNAM TYPE VBRP-ERNAM,
      SFAKN TYPE VBRK-SFAKN,                                              "已取消的出具发票凭证编号
      FKSTO TYPE vbrk-FKSTO,                                              " 出具发票凭证被取消  add by yetp20180711
      ZJSHM TYPE TLINE-TDLINE,
      AUGRU TYPE VBAK-AUGRU,  " 订单原因
      ZCKDJ TYPE LIPS-VGBEL,  " 参考单据的单据编号
      ZCKXM TYPE LIPS-VGPOS,  " 参考项目的项目号
      VGTYP TYPE LIPS-VGTYP,  " SD 凭证类别
      ZGZRQ TYPE LIKP-WADAT_IST,  " 过账日期
      KNKLI TYPE VBRK-KNKLI,    " 信贷账户号
      ZHJJE TYPE P DECIMALS 2,                                            "合计金额
      END OF TY_YKP.

TYPES:BEGIN OF TY_VBPA,
      VBELN TYPE VBPA-VBELN,
      KUNNR TYPE VBPA-KUNNR,
<font color ="#0000FF">*      POSNR type vbpa-POSNR,</font>
<font color ="#0000FF">*      SORTL type kna1-SORTL,</font>
      END OF TY_VBPA,

      BEGIN OF TY_T006A,
      MSEHI TYPE T006A-MSEHI,
      MSEHL TYPE T006A-MSEHL,
      END OF TY_T006A,

      BEGIN OF TY_KNA1,
      KUNNR TYPE KNA1-KUNNR,
      SORTL TYPE KNA1-SORTL,
      NAME1 TYPE KNA1-NAME1,
      END OF TY_KNA1,

      BEGIN OF TY_VBRP,
      AUBEL TYPE VBRP-AUBEL,
      AUPOS TYPE VBRP-AUPOS,
      FKIMG TYPE VBRP-FKIMG,
      VGBEL TYPE VBRP-VGBEL,
      VGPOS TYPE VBRP-VGPOS,
      VBELN TYPE VBRP-VBELN,  " 开票凭证      添加于 2017-12-22
      POSNR TYPE VBRP-POSNR,  " 出具发票项目  添加于 2017-12-22
      NETWR TYPE VBRP-NETWR,
      MWSBP TYPE VBRP-MWSBP,
      AUGRU TYPE VBAK-AUGRU,  " 订单拒绝原因

      END OF TY_VBRP,

      BEGIN OF TY_KONP,
      MWSKZ LIKE A003-MWSKZ,
      KNUMH LIKE A003-KNUMH,
      KBETR LIKE KONP-KBETR,
      END OF TY_KONP,

      BEGIN OF TY_TVFKT,
      FKART TYPE TVFKT-FKART,
      VTEXT TYPE TVFKT-VTEXT,
      END OF TY_TVFKT,

      BEGIN OF TY_EKKO,
      EBELN TYPE EKPO-EBELN,
      EBELP TYPE EKPO-EBELP,
      WAERS TYPE EKKO-WAERS,
      MATNR TYPE EKPO-MATNR,
      NETWR TYPE EKPO-NETWR,
      MWSKZ TYPE EKPO-MWSKZ,
      MEINS TYPE EKPO-MEINS,
      MENGE TYPE EKPO-MENGE,
      KBETR LIKE KONP-KBETR,
      END OF TY_EKKO.

TYPES: BEGIN OF TY_JSHM,
          VBELN TYPE VBPA-VBELN,
          ZJSHM TYPE TLINE-TDLINE,
       END OF TY_JSHM.

<font color ="#0000FF">********add by yetp 20180914*******start</font>
types: BEGIN OF tY_pz,
      ZCKDJ TYPE LIPS-VGBEL,  " 参考单据的单据编号
      sl TYPE VBRP-FKIMG,
       END OF ty_pz.
<font color ="#0000FF">********add by yetp 20180914*******end</font>
<font color ="#0000FF">************************************************************************</font>
<font color ="#0000FF">* 内表声明</font>
<font color ="#0000FF">************************************************************************</font>
DATA:GT_WKP TYPE STANDARD TABLE OF TY_WKP,
     W_WKP TYPE TY_WKP,
     GT_ALV_WKP TYPE STANDARD TABLE OF TY_WKP,
     W_ALV_WKP TYPE TY_WKP,

     "*****add  2015-11-21
     GT_ALV_WKP_ZONG TYPE STANDARD TABLE OF TY_WKP,


     GT_YKP TYPE STANDARD TABLE OF TY_YKP,
     GT_ALV_YKP TYPE STANDARD TABLE OF TY_YKP,

     "*****aadd  2015-11-21
     GT_YKP_ZONG TYPE STANDARD TABLE OF TY_YKP,

     W_ALV_YKP TYPE TY_YKP,
     W_YKP TYPE TY_YKP,
     GT_T006A TYPE STANDARD TABLE OF TY_T006A,
     W_T006A TYPE TY_T006A,
     GT_EKKO TYPE STANDARD TABLE OF TY_EKKO,
     W_EKKO TYPE TY_EKKO,
     GT_KONP TYPE STANDARD TABLE OF TY_KONP,
     W_KONP TYPE TY_KONP,
     GT_VBRP TYPE STANDARD TABLE OF TY_VBRP,
     W_VBRP TYPE TY_VBRP,
     GT_TVFKT TYPE STANDARD TABLE OF TY_TVFKT,
     W_TVFKT TYPE TY_TVFKT,
     GT_KNA1 TYPE STANDARD TABLE OF TY_KNA1,
     W_KNA1 TYPE TY_KNA1,
     GT_VBPA_KPF TYPE STANDARD TABLE OF TY_VBPA,
     W_VBPA_KPF TYPE TY_VBPA,
     GT_VBPA_FKF TYPE STANDARD TABLE OF TY_VBPA,
     W_VBPA_FKF TYPE TY_VBPA,
     GT_FIELDCAT TYPE SLIS_T_FIELDCAT_ALV,
      W_FIELDCAT  TYPE SLIS_FIELDCAT_ALV,
      W_LAYOUT    TYPE SLIS_LAYOUT_ALV.

DATA: GT_JSHM TYPE STANDARD TABLE OF TY_JSHM,
      W_JSHM TYPE TY_JSHM.

<font color ="#0000FF">********add by yetp 20180914*******start</font>
data:gt_pz_xs type STANDARD TABLE OF ty_pz,
     w_pz_xs type ty_pz.
data:gt_pz_cg TYPE STANDARD TABLE OF ty_pz,
     w_pz_cg type ty_pz.
data:gt_sl type STANDARD TABLE OF  ty_pz,
     w_sl type  ty_pz.
<font color ="#0000FF">********add by yetp 20180914*******end</font>
<font color ="#0000FF">*************************************************************************</font>
<font color ="#0000FF">** 事件接收类定义</font>
<font color ="#0000FF">*************************************************************************</font>
<font color ="#0000FF">*class cl_event_receiver DEFINITION.</font>
<font color ="#0000FF">*  PUBLIC SECTION.</font>
<font color ="#0000FF">*   methods:</font>
<font color ="#0000FF">*      handle_dclick " 双击</font>
<font color ="#0000FF">*        FOR EVENT double_click OF cl_gui_alv_grid</font>
<font color ="#0000FF">*        IMPORTING e_row e_column es_row_no.</font>
<font color ="#0000FF">* ENDCLASS.</font>
<font color ="#0000FF">************************************************************************</font>
<font color ="#0000FF">* 字段符声明</font>
<font color ="#0000FF">************************************************************************</font>
FIELD-SYMBOLS:&lt;FS_WKP&gt; TYPE TY_WKP,
              &lt;FS_ALV_WKP&gt; TYPE TY_WKP,
              &lt;FS_YKP&gt; TYPE TY_YKP,
              &lt;FS_EKKO&gt; TYPE TY_EKKO,
              &lt;fs_pz_xs&gt; type ty_pz,
              &lt;fs_sl&gt;   type ty_pz,
              &lt;FS_VBRP&gt; TYPE TY_VBRP.
<font color ="#0000FF">************************************************************************</font>
<font color ="#0000FF">* 全局变量声明</font>
<font color ="#0000FF">************************************************************************</font>
<font color ="#0000FF">*DATA:g_fkimg TYPE vbrp-fkimg,</font>
<font color ="#0000FF">*     g_netwr type vbrp-netwr,</font>
<font color ="#0000FF">*     g_mwsbp type vbrp-mwsbp,</font>

DATA:    G_UCOMM TYPE SY-UCOMM.
<font color ="#0000FF">*     alv_grid_wk TYPE REF TO cl_gui_alv_grid,</font>
<font color ="#0000FF">*     wa_custom_cont_wk TYPE REF TO cl_gui_custom_container,</font>
<font color ="#0000FF">*     gt_fcat_wk TYPE lvc_t_fcat,</font>
<font color ="#0000FF">*     w_layout_wk TYPE lvc_s_layo,</font>
<font color ="#0000FF">*     wa_cont_wkd TYPE scrfname VALUE 'CTRL_ALV2',   " 未开票明细</font>
<font color ="#0000FF">*     alv_grid_wkd TYPE REF TO cl_gui_alv_grid,</font>
<font color ="#0000FF">*     wa_custom_cont_wkd TYPE REF TO cl_gui_custom_container,</font>
<font color ="#0000FF">*     gt_fcat_wkd TYPE lvc_t_fcat,</font>
<font color ="#0000FF">*     w_layout_wkd TYPE lvc_s_layo,</font>
<font color ="#0000FF">*     wa_cont_yk TYPE scrfname VALUE 'CTRL_ALV3',   " 已开票</font>
<font color ="#0000FF">*     alv_grid_yk TYPE REF TO cl_gui_alv_grid,</font>
<font color ="#0000FF">*     wa_custom_cont_yk TYPE REF TO cl_gui_custom_container,</font>
<font color ="#0000FF">*     gt_fcat_yk TYPE lvc_t_fcat,</font>
<font color ="#0000FF">*     w_layout_yk TYPE lvc_s_layo,</font>
<font color ="#0000FF">*     wa_cont_ykd TYPE scrfname VALUE 'CTRL_ALV4',   " 已开票明细</font>
<font color ="#0000FF">*     alv_grid_ykd TYPE REF TO cl_gui_alv_grid,</font>
<font color ="#0000FF">*     wa_custom_cont_ykd TYPE REF TO cl_gui_custom_container,</font>
<font color ="#0000FF">*     gt_fcat_ykd TYPE lvc_t_fcat,</font>
<font color ="#0000FF">*     w_layout_ykd TYPE lvc_s_layo,</font>
<font color ="#0000FF">*     g_modify_flag TYPE c,</font>
<font color ="#0000FF">*     ok_code TYPE sy-ucomm,</font>
<font color ="#0000FF">*     save_code TYPE sy-ucomm.</font>
<font color ="#0000FF">************************************************************************</font>
<font color ="#0000FF">* 定义选择屏幕参数</font>
<font color ="#0000FF">************************************************************************</font>


SELECTION-SCREEN BEGIN OF BLOCK BLK3 WITH FRAME TITLE TEXT-002.

PARAMETERS: P_CB1 TYPE C RADIOBUTTON GROUP G2 DEFAULT 'X',  "明细
            P_CB2 TYPE C RADIOBUTTON GROUP G2.              "汇总

SELECTION-SCREEN END OF BLOCK BLK3.




SELECTION-SCREEN:BEGIN OF BLOCK BLK1 WITH FRAME TITLE TEXT-001.
SELECT-OPTIONS:S_PZH FOR VBRP-VBELN,
               S_SDF FOR VBRK-KUNAG,
               S_FKF FOR VBRK-KUNAG,  " 付款方
               S_WLBM FOR VBRP-MATNR,
               S_XSZZ FOR VBRP-VKORG_AUFT OBLIGATORY,
               S_VBELN FOR VBAK-VBELN,  " 销售凭证
               S_KPLB FOR VBRK-FKART,
               S_CJFPRQ FOR VBRK-FKDAT DEFAULT SY-DATUM TO SY-DATUM OBLIGATORY,
               S_GZRQ FOR LIKP-WADAT_IST,
               S_CJFPLB FOR VBRK-FKTYP,
               S_CPCC FOR VBRP-PRODH MODIF ID M1,
               S_KNKLI FOR VBRK-KNKLI.
PARAMETERS:P_WKP TYPE C RADIOBUTTON GROUP G1 USER-COMMAND SELE DEFAULT 'X',
           P_YKP TYPE C RADIOBUTTON GROUP G1,
           p_ck type c as CHECKBOX MODIF ID m2,
           P_CHECK TYPE C AS CHECKBOX,
           P_THH TYPE C AS CHECKBOX DEFAULT 'X' MODIF ID M1.  " 排除退换货
SELECTION-SCREEN:END OF BLOCK BLK1.

<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*&      DEFINE MACRO_FILL_FIELDCAT</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*       填充结构宏定义</font>
<font color ="#0000FF">*----------------------------------------------------------------------*</font>
DEFINE MACRO_FILL_FIELDCAT.
  CLEAR W_FIELDCAT.
  &1 = &1 + 1.
  W_FIELDCAT-COL_POS    = &1.
  W_FIELDCAT-FIELDNAME  = &2.
  W_FIELDCAT-SELTEXT_L     = &3.
  W_FIELDCAT-SELTEXT_M     = &3.
  W_FIELDCAT-SELTEXT_S     = &3.
  W_FIELDCAT-NO_ZERO       = &4.
  W_FIELDCAT-OUTPUTLEN     = &5.
  APPEND W_FIELDCAT TO GT_FIELDCAT.
END-OF-DEFINITION.
</pre>
<hr>
<font size="2" face = "Sans Serif">Extracted by Direct Download Enterprise version 1.3.1 - E.G.Mellodew. 1998-2005 UK. Sap Release 702
</font>
</body>
</html>
